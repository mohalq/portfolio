<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ø³Ø¹ÙˆØ¯ Ø¨ÙˆÙ†Ø®Ù„ </title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: sans-serif;
      direction: rtl;
    }
    .comment-box {
      margin: 20px auto;
      max-width: 600px;
      text-align: right;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: none;
    }
    button {
      padding: 10px 20px;
      background: orange;
      border: none;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    .comment {
      background: #222;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
    }
    .meta {
      font-size: 0.9em;
      color: gray;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<p style="font-size: xx-large; color: orange; text-align: center;">Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ø³Ø¹ÙˆØ¯ Ø¨ÙˆÙ†Ø®Ù„ </p>
<p style="text-align: center; color: blueviolet; font-size: xx-large;">
  Ù…Ø³Ø§Ø­Ø© Ø®Ø§ØµØ© Ù„Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø¯ÙƒØªÙˆØ± - Ø§Ù„Ø¯Ø±Ø¬Ø§Øª - Ø§Ù„ØªØ¹Ø§Ù…Ù„ - Ø§Ù„Ø´Ø±Ø­<br>
  ÙŠÙØ¶Ù„ Ø°ÙƒØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ØªÙŠ Ø£Ø®Ø°ØªÙ‡Ø§ Ù…Ø¹Ù‡!
</p>

<div class="container comment-box">
  <h2>Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ùƒ</h2>
  <input type="text" id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  <textarea id="commentInput" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
  <button onclick="submitComment()">Ø¥Ø±Ø³Ø§Ù„</button>

  <h3 style="margin-top: 30px;">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h3>
  <div id="comments"></div>
</div>

<script>
  // âœ… Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAWfsomjm1p1URO0_3vBdtl_aeNYME5FfY",
    authDomain: "almohandes-ksu.firebaseapp.com",
    databaseURL: "https://almohandes-ksu-default-rtdb.firebaseio.com",
    projectId: "almohandes-ksu",
    storageBucket: "almohandes-ksu.firebasestorage.app",
    messagingSenderId: "510058272031",
    appId: "1:510058272031:web:3cd0e0ae0b15cf094b4c2a"
  };

  // âœ… Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // âœ… Format timestamp in Arabic
  function formatDate(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleString('ar-EG', {
      dateStyle: 'medium',
      timeStyle: 'short'
    });
  }

  // âœ… Submit comment with validation
  function submitComment() {
    const text = document.getElementById('commentInput').value.trim();
    const name = document.getElementById('nameInput').value.trim();

    if (text === '') {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚ Ø£ÙˆÙ„Ø§Ù‹');
      return;
    }

    // ğŸ”’ Simple spam filter
    const bannedWords = ['spam', 'ØªØ®ÙÙŠØ¶Ø§Øª', 'Ø®ØµÙ…', 'Ø±Ø§Ø¨Ø·', 'http', 'www', 'ğŸ’°', '!!!', '****', 'ÙƒØ³Ø¨', 'Ù…Ø±Ø¨Ø­', 'click'];
    const textLower = text.toLowerCase();
    for (const word of bannedWords) {
      if (textLower.includes(word)) {
        alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù„Ø§Ø­ØªÙˆØ§Ø¦Ù‡ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ØºÙŠØ± Ù„Ø§Ø¦Ù‚Ø© Ø£Ùˆ Ù…Ø­ØªÙˆÙ‰ Ø¯Ø¹Ø§Ø¦ÙŠ.');
        return;
      }
    }

    // ğŸ” Limit to 2 comments per device
    const count = Number(localStorage.getItem('userCommentCount') || 0);
    if (count >= 1) {
      alert('Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (ØªØ¹Ù„ÙŠÙ‚ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ../).');
      return;
    }

    const newComment = {
      text,
      name: name || 'Ù…Ø¬Ù‡ÙˆÙ„',
      timestamp: Date.now()
    };

    db.ref('comments').push(newComment);

    // ğŸ§  Save to localStorage
    localStorage.setItem('userCommentCount', count + 1);

    // Clear form
    document.getElementById('commentInput').value = '';
    document.getElementById('nameInput').value = '';
  }

  // âœ… Display comments
  db.ref('comments').on('child_added', snapshot => {
    const comment = snapshot.val();
    const div = document.createElement('div');
    div.className = 'comment';

    const name = comment.name || 'Ù…Ø¬Ù‡ÙˆÙ„';
    const date = formatDate(comment.timestamp);

    div.innerHTML = `
      <div>${comment.text}</div>
      <div class="meta">â€” ${name} | ${date}</div>
    `;

    document.getElementById('comments').prepend(div);
  });
</script>

</body>
</html>
